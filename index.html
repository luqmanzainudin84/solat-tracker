<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Solat Tracker</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #f2f2f2;
}

.container {
  max-width: 420px;
  margin: 20px auto;
  padding: 10px;
}

h2 {
  text-align: center;
}

.date {
  text-align: center;
  font-size: 14px;
  margin-bottom: 10px;
}

.card {
  background: #fff;
  border-radius: 10px;
  padding: 10px;
}

.row {
  display: flex;
  justify-content: space-between;
  padding: 10px;
  border-bottom: 1px solid #eee;
}

.row:last-child {
  border-bottom: none;
}

.pill {
  padding: 6px 14px;
  border-radius: 12px;
  font-size: 13px;
  color: #fff;
  cursor: pointer;
}

.grey { background: #9e9e9e; }
.red { background: #e53935; }
.yellow { background: #fbc02d; color:#000; }
.green { background: #43a047; }
.gold { background: #fdd835; color:#000; }

/* Popup */
.popup {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.6);
  display: flex;
  justify-content: center;
  align-items: center;
}

.popup.hidden {
  display: none;
}

.popup-box {
  background: #fff;
  padding: 15px;
  border-radius: 10px;
  width: 90%;
  max-width: 340px;
}

.popup-box h3 {
  text-align: center;
  margin-top: 0;
}

.popup-buttons {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
}

.popup-buttons button {
  padding: 10px;
  border: none;
  border-radius: 8px;
  font-size: 14px;
  cursor: pointer;
}

.cancel {
  margin-top: 10px;
  width: 100%;
  background: #ccc;
}

/* Debug */
.debug {
  margin-top: 15px;
  background: #111;
  color: #0f0;
  padding: 8px;
  font-size: 11px;
  border-radius: 6px;
  max-height: 160px;
  overflow-y: auto;
}
</style>
</head>

<body>

<div class="container">
  <h2>Solat Tracker</h2>
  <div id="dateText" class="date"></div>

  <div class="card">
    <div class="row"><span>Subuh</span><span class="pill grey" onclick="openPopup('subuh')" id="subuh">Belum</span></div>
    <div class="row"><span>Zohor</span><span class="pill grey" onclick="openPopup('zohor')" id="zohor">Belum</span></div>
    <div class="row"><span>Asar</span><span class="pill grey" onclick="openPopup('asar')" id="asar">Belum</span></div>
    <div class="row"><span>Maghrib</span><span class="pill grey" onclick="openPopup('maghrib')" id="maghrib">Belum</span></div>
    <div class="row"><span>Isyak</span><span class="pill grey" onclick="openPopup('isyak')" id="isyak">Belum</span></div>
  </div>

  <div id="debug" class="debug"></div>
</div>

<!-- POPUP -->
<div id="popup" class="popup hidden">
  <div class="popup-box">
    <h3 id="popupTitle"></h3>

    <div class="popup-buttons">
      <button class="red" onclick="submit(0)">✖ Tak Solat</button>
      <button class="yellow" onclick="submit(1)">⏱ Lewat</button>
      <button class="green" onclick="submit(2)">✔ Awal</button>
      <button class="gold" onclick="submit(3)">⭐ Jemaah</button>
    </div>

    <button class="cancel" onclick="closePopup()">Cancel</button>
  </div>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbzFBjzszIHx3rSfsepgm3uJnCEFlGrgcc_AnEOBLC6eMfHf-gfxZiRJ3Gh58P2BfY6E/exec";

let selectedSolat = null;
let today = new Date().toISOString().slice(0,10);

const labels = ["Tak Solat","Lewat","Awal","Jemaah","Belum"];
const colors = ["red","yellow","green","gold","grey"];

function log(msg) {
  const d = document.getElementById("debug");
  d.innerHTML += `[${new Date().toLocaleTimeString()}] ${msg}<br>`;
  d.scrollTop = d.scrollHeight;
}

document.getElementById("dateText").innerText =
  new Date().toLocaleDateString("ms-MY",{weekday:"long",year:"numeric",month:"long",day:"numeric"});

function openPopup(solat) {
  log("openPopup: " + solat);
  selectedSolat = solat;
  document.getElementById("popupTitle").innerText = solat.toUpperCase();
  document.getElementById("popup").classList.remove("hidden");
}

function closePopup() {
  log("closePopup");
  document.getElementById("popup").classList.add("hidden");
}

function updatePill(solat, val) {
  const el = document.getElementById(solat);
  el.textContent = labels[val];
  el.className = "pill " + colors[val];
}

async function submit(val) {
  log("submit: " + selectedSolat + " = " + val);
  try {
    const res = await fetch(API,{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({
        date: today,
        solat: selectedSolat,
        value: val
      })
    });
    const t = await res.text();
    log("API: " + t);
    updatePill(selectedSolat,val);
    closePopup();
  } catch(e) {
    log("ERROR: " + e.message);
  }
}

log("JS loaded OK");
</script>

</body>
</html>
