<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Solat Tracker</title>

<style>
body { font-family: Arial; background:#f2f2f2; margin:0 }
.container { max-width:420px; margin:20px auto }
.card { background:#fff; padding:12px; border-radius:10px }
.row { display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #eee }
.row:last-child { border-bottom:none }
.pill { padding:6px 14px; border-radius:12px; color:#fff; cursor:pointer }
.grey{background:#9e9e9e} .red{background:#e53935}
.yellow{background:#fbc02d;color:#000}
.green{background:#43a047} .gold{background:#fdd835;color:#000}

.popup { position:fixed; inset:0; background:rgba(0,0,0,.6);
display:flex; justify-content:center; align-items:center }
.hidden{display:none}
.box{background:#fff;padding:15px;border-radius:10px;width:90%;max-width:340px}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
button{padding:10px;border:none;border-radius:8px;font-size:14px;cursor:pointer}
.cancel{margin-top:10px;width:100%;background:#ccc}
</style>
</head>

<body>
<div class="container">
<h2 align="center">Solat Tracker</h2>
<div id="dateText" align="center"></div>

<div class="card">
<div class="row"><span>Subuh</span><span id="subuh" class="pill grey" onclick="openP('subuh')">Belum</span></div>
<div class="row"><span>Zohor</span><span id="zohor" class="pill grey" onclick="openP('zohor')">Belum</span></div>
<div class="row"><span>Asar</span><span id="asar" class="pill grey" onclick="openP('asar')">Belum</span></div>
<div class="row"><span>Maghrib</span><span id="maghrib" class="pill grey" onclick="openP('maghrib')">Belum</span></div>
<div class="row"><span>Isyak</span><span id="isyak" class="pill grey" onclick="openP('isyak')">Belum</span></div>
</div>
</div>

<div id="popup" class="popup hidden">
<div class="box">
<h3 id="title"></h3>
<div class="grid">
<button class="red" onclick="setVal(0)">✖ Tak Solat</button>
<button class="yellow" onclick="setVal(1)">⏱ Lewat</button>
<button class="green" onclick="setVal(2)">✔ Awal</button>
<button class="gold" onclick="setVal(3)">⭐ Jemaah</button>
</div>
<button class="cancel" onclick="closeP()">Cancel</button>
</div>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbwRxMoxud-Rsn__BoiKQyOtPc9M0n-Q-gCUmDFVkUhUmSXdCyagCb5JruxUEDzA8ulq/exec";
const labels=["Tak Solat","Lewat","Awal","Jemaah","Belum"];
const colors=["red","yellow","green","gold","grey"];
let solat=null;
let date=new Date().toISOString().slice(0,10);

document.getElementById("dateText").innerText =
new Date().toLocaleDateString("ms-MY",{weekday:"long",year:"numeric",month:"long",day:"numeric"});

function openP(s){ solat=s; title.innerText=s.toUpperCase(); popup.classList.remove("hidden"); }
function closeP(){ popup.classList.add("hidden"); }

function updateP(s,v){
const el=document.getElementById(s);
el.textContent=labels[v];
el.className="pill "+colors[v];
}

async function setVal(v){
await fetch(`${API}?mode=update&date=${date}&solat=${solat}&value=${v}`);
updateP(solat,v);
closeP();
}

fetch(`${API}?mode=detail&date=${date}`)
.then(r=>r.json())
.then(d=>{
["subuh","zohor","asar","maghrib","isyak"].forEach(s=>updateP(s,d[s]));
});
</script>
</body>
</html>
